@model StationeryWEB.Models.OrderDetail

@{
    ViewData["Title"] = "Create Order Detail";
}

<h2>Create Order Detail</h2>

<form id="orderDetailForm">
    <div>
        <label for="orderId">Order ID:</label>
        <input type="text" id="orderId" name="orderId" required>
    </div>
    <div>
        <label for="productId">Product ID:</label>
        <input type="text" id="productId" name="productId" required>
    </div>
    <div>
        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" required>
    </div>
    <div>
        <label for="discount">Discount:</label>
        <input type="number" id="discount" name="discount" step="0.01">
    </div>
    <div>
        <label for="totalAmount">Total Amount:</label>
        <input type="number" id="totalAmount" name="totalAmount" step="0.01">
    </div>
    <button type="submit">Submit Order Detail</button>
</form>

<div id="orderDetailResult"></div>

@section Scripts {
    <script>
        document.getElementById('orderDetailForm').addEventListener('submit', async function (event) {
            event.preventDefault(); // Prevent the default form submission

            // Gather form data into an orderDetail object
            var orderDetail = {
                orderId: document.getElementById('orderId').value,
                productId: document.getElementById('productId').value,
                quantity: parseInt(document.getElementById('quantity').value, 10),
                discount: parseFloat(document.getElementById('discount').value) || null,
                totalAmount: parseFloat(document.getElementById('totalAmount').value) || null
            };

            try {
                const response = await fetch('https://localhost:7106/api/Customer/CreateOrderDetail', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderDetail)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Failed to create order detail:', errorData);
                    document.getElementById('orderDetailResult').textContent = 'Failed to create order detail: ' + JSON.stringify(errorData);
                } else {
                    const createdOrderDetail = await response.json();
                    console.log('Order detail created:', createdOrderDetail);

                    document.getElementById('orderDetailResult').innerHTML = `
                                                <h3>Order Detail Created Successfully!</h3>
                                                <div><strong>Detail ID:</strong> ${createdOrderDetail.detailId}</div>
                                                <div><strong>Order ID:</strong> ${createdOrderDetail.orderId}</div>
                                                <div><strong>Product ID:</strong> ${createdOrderDetail.productId}</div>
                                                <div><strong>Quantity:</strong> ${createdOrderDetail.quantity}</div>
                                                <div><strong>Discount:</strong> ${createdOrderDetail.discount ? createdOrderDetail.discount.toFixed(2) : 'N/A'}</div>
                                                <div><strong>Total Amount:</strong> ${createdOrderDetail.totalAmount ? createdOrderDetail.totalAmount.toFixed(2) : 'N/A'}</div>
                                            `;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('orderDetailResult').textContent = 'An error occurred while sending the order detail.';
            }
        });
    </script>
}
