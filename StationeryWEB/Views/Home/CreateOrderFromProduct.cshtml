﻿@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model StationeryAPI.ShoppingModels.NewOrder

@{
    ViewData["Title"] = "Create Order";
    Layout = "~/Views/Shared/_DealerLayout.cshtml";
}
<div class="row">
    <div class="col-md-12">
        <div class="ibox">
            <div class="ibox-head">
                <div class="ibox-title">Tạo đơn hàng</div>
            </div>
            <div class="ibox-body">
                <form id="orderForm">
                    <div class="row">
                        <div class="col-sm-6 form-group">
                            <label for="customerId">ID Khách Hàng</label>
                            <input class="form-control" type="text" id="customerId" name="customerId" value="@ViewBag.cusid" readonly required placeholder="ID Khách">
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="productId">ID Sản Phẩm</label>
                            <input class="form-control" type="text" id="productId" name="productId" value="@ViewBag.proid" readonly required placeholder="Mã sản phẩm">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 form-group">
                            <label for="totalPrice">Tổng giá</label>
                            <input class="form-control" type="number" id="totalPrice" name="totalPrice" value="@ViewBag.price" readonly required step="0.01" placeholder="Tổng giá">
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="orderStatus">Trạng thái đơn hàng</label>
                            <input class="form-control" type="text" id="orderStatus" name="orderStatus" value="@ViewBag.status" required placeholder="Trạng thái đơn hàng">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-sm-6">
                            <label for="deliveryType">Phí giao hàng</label>
                            <select class="form-control input-sm" id="deliveryType" name="deliveryType" required placeholder="Phương thức giao hàng">
                                <option value="VPP" value="HOLD" selected>Phương thức giao hàng</option>
                                <option value="NHANH">Nhanh</option>
                                <option value="HOATOC">Hỏa tốc</option>
                            </select>
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="deliveryFee">Phí giao hàng</label>
                            <input class="form-control" type="number" id="deliveryFee" name="deliveryFee" required step="0.01" placeholder="Phí giao hàng">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-sm-6">
                            <label for="paymentStatus">Trạng thái đơn</label>
                            <select class="form-control input-sm" id="paymentStatus" name="paymentStatus" required placeholder="Trạng thái thanh toán">
                                <option value="VPP" value="HOLD" selected>Trạng thái thanh toán đơn</option>
                                <option value="WAITING">waiting</option>
                                <option value="HOLD">hold</option>
                                <option value="SUCCESS">success</option>
                            </select>
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="paymentMethod">Phương thức thanh toán</label>
                            <select class="form-control input-sm" id="paymentMethod" name="paymentMethod" required placeholder="Phương thức thanh toán">
                                <option value="VPP" value="HOLD" selected>Vui lòng chọn phương thức thanh toán</option>
                                <option value="VPP">VPP</option>
                                <option value="COD">COD</option>
                            </select>
                        </div>
                    </div>
                   
                    <div class="row">
                        <div class="col-sm-6 form-group">
                           <button class="btn btn-success" type="submit">Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <div class="ibox">
           <div class="ibox-body">
                <div id="orderResult"></div>
           </div>
        </div>

    </div>
</div>
@section Scripts {
    <script>
        document.getElementById('orderForm').addEventListener('submit', async function (event) {
            event.preventDefault(); // Prevent the default form submission

            // Gather form data into an order object
            var order = {
                customerId: document.getElementById('customerId').value,
                productId: document.getElementById('productId').value,
                totalPrice: parseFloat(document.getElementById('totalPrice').value),
                orderStatus: document.getElementById('orderStatus').value,
                deliveryType: document.getElementById('deliveryType').value,
                deliveryFee: parseFloat(document.getElementById('deliveryFee').value),
                paymentMethod: document.getElementById('paymentMethod').value,
                paymentStatus: document.getElementById('paymentStatus').value,
                // Set other properties as needed
            };

            try {
                const response = await fetch('https://localhost:7106/api/Customer/CreateOrder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(order)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Failed to create order:', errorData);
                    document.getElementById('orderResult').textContent = 'Failed to create order: ' + JSON.stringify(errorData);
                } else {
                    const createdOrder = await response.json();
                    console.log('Order created:', createdOrder);

                    // Here is where you place the code to update the 'orderResult' div
                    document.getElementById('orderResult').innerHTML = `
                                                                          <form id="orderForm">
                      <div class="row">
                          <div class="col-sm-12 form-group">
                              <label for="customerId">ID Khách Hàng:</label>
                              <input class="form-control" type="text" id="customerId" name="customerId" value="${createdOrder.customerId}" readonly required placeholder="ID Khách">
                          </div>
                      </div>
                    <div class="row">
                          <div class="form-group col-sm-6">
                              <label for="orderStatus">Thời gian đặt hàng</label>
                              <input class="form-control" type="text" id="orderStatus" name="orderStatus" value="${new Date(createdOrder.orderDate).toLocaleString()}" readonly required placeholder="Trạng thái đơn hàng">
                          </div>
                                  <div class="col-sm-6 form-group">
                                      <label for="deliveryType">Phương thức giao hàng</label>
                                      <input class="form-control" type="text" id="deliveryType" name="deliveryType" value="${createdOrder.deliveryType}" readonly required placeholder="Phương thức giao hàng">
                                  </div>
                      </div>
                    <div class="row">
                          <div class="col-sm-6 form-group">
                              <label for="paymentMethod">Phương thức thanh toán</label>
                              <input class="form-control" type="text" id="paymentMethod" name="paymentMethod" value="${createdOrder.paymentMethod}" readonly required placeholder="Phương thức thanh toán">
                          </div>
                          <div class="form-group col-sm-6">
                              <label for="paymentStatus">Trạng thái thanh toán</label>
                              <input class="form-control" type="text" id="paymentStatus" name="paymentStatus" value="${createdOrder.paymentStatus}" readonly required placeholder="Trạng thái thanh toán">
                          </div>
                      </div>
                                      <a href="/Home/GetCustomerProductByDealer">Về trang trước</a>
                </form>


                                                            `;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('orderResult').textContent = 'An error occurred while sending the order.';
            }
        });
    </script>
}