@model StationeryWEB.Models.UpdateOrder


@{
    ViewData["Title"] = "Update Order";
    Layout = "~/Views/Shared/_DealerLayout.cshtml";
}
<div class="row">
    <div class="col-md-6">
        <div class="ibox">
            <div class="ibox-head">
                <div class="ibox-title">Cập nhật thông tin đơn hàng</div>
            </div>
            <div class="ibox-body">
                <form id="updateorderForm">
                    <div class="row">
                        <div class="col-sm-6 form-group">
                            <label for="orderId">Mã đơn hàng</label>
                            <input class="form-control" type="text" id="orderId" name="orderId" readonly value="@Model.OrderId" required placeholder="Mã đơn hàng">
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="customerId">ID Khách hàng</label>
                            <input class="form-control" type="text" id="customerId" name="customerId" readonly value="@Model.CustomerId" placeholder="ID khách hàng" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 form-group">
                            <label for="DeliveryFee">Delivery Fee</label>
                            <input class="form-control" type="number" id="deliveryFee" name="deliveryFee" value="@Model.DeliveryFee" required step="0.01" placeholder="Phí giao hàng" />
                        </div>
                        <div class="col-sm-6 form-group" id="date_3">
                            <label class="font-normal" for="orderDate">Ngày đặt</label>
                            <div class="input-group date">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input class="form-control" type="date" id="orderDate" value="@Model.OrderDate.ToString("yyyy-MM-dd")" name="orderDate" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 form-group">
                            <label for="productId">ID sản phẩm</label>
                            <input class="form-control" type="text" id="productId" value="@Model.productId" name="productId" required placeholder="ID sản phẩm">
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="totalPrice">Giá đơn</label>
                            <input class="form-control" type="number" id="totalPrice" name="totalPrice" value="@Model.TotalPrice" required step="0.01" placeholder="Tổng giá" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 form-group">
                            <label for="orderStatus">Trạng thái đơn hàng</label>
                            <select class="form-control input-sm" id="orderStatus" name="orderStatus"  required placeholder="Trạng thái thanh toán">
                                <option value="@Model.OrderStatus" selected>@Model.OrderStatus</option>
                                <option value="CANCELLED">CANCELLED</option>
                                <option value="DONE">DONE</option>
                                <option value="WAITING">WAITING</option>
                            </select>
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="deliveryType">Phương thức giao hàng</label>
                            <select class="form-control input-sm" id="deliveryType" name="deliveryType" required placeholder="Phương thức giao hàng">
                                <option value="@Model.DeliveryType" selected>@Model.DeliveryType</option>
                                <option value="NHANH">Nhanh</option>
                                <option value="HOATOC">Hỏa tốc</option>
                                <option value="TIETKIEM">Tiết kiệm</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-sm-6">
                            <label for="paymentStatus">Trạng thái thanh toán</label>
                            <select class="form-control input-sm" id="paymentStatus" name="paymentStatus" required placeholder="Trạng thái thanh toán">
                                <option value="@Model.PaymentStatus" selected>@Model.PaymentStatus</option>
                                <option value="DONE">DONE</option>
                                <option value="HOLD">HOLD</option>
                                <option value="WAITING">WAITING</option>
                            </select>
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="paymentMethod">Phương thức thanh toán</label>
                            <select class="form-control input-sm" id="paymentMethod" name="paymentMethod" required placeholder="Phương thức thanh toán">
                                <option value="@Model.PaymentMethod" selected>@Model.PaymentMethod</option>
                                <option value="COD">COD</option>
                                <option value="VPP">VPP</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-success btn-rounded" type="submit">Cập nhật</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div id="orderResult"></div>
    </div>
</div>



@section Scripts {
    <script>
        document.getElementById('updateorderForm').addEventListener('submit', async function (event) {
            event.preventDefault(); // Prevent the default form submission

            // Gather form data into an order object
            var order = {
                orderId: document.getElementById('orderId').value,
                orderDate: document.getElementById('orderDate').value,
                customerId: document.getElementById('customerId').value,
                productId: document.getElementById('productId').value,
                totalPrice: parseFloat(document.getElementById('totalPrice').value),
                orderStatus: document.getElementById('orderStatus').value,
                deliveryType: document.getElementById('deliveryType').value,
                deliveryFee: parseFloat(document.getElementById('deliveryFee').value),
                paymentMethod: document.getElementById('paymentMethod').value,
                paymentStatus: document.getElementById('paymentStatus').value,
                // Set other properties as needed
            };

            try {
                const response = await fetch('https://localhost:7106/api/Customer/UpdateOrder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(order)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Failed to create order:', errorData);
                    document.getElementById('orderResult').textContent = 'Failed to create order: ' + JSON.stringify(errorData);
                } else {
                    const returnorder = await response.json();
                    console.log('Order updated:', returnorder);

                    // Here is where you place the code to update the 'orderResult' div
                    document.getElementById('orderResult').innerHTML = `

                  
            <div class="ibox">
                <div class="ibox-head">
                    <div class="ibox-title">ĐƠN HÀNG ĐÃ ĐƯỢC CẬP NHẬT !!!</div>
                </div>
                <div class="ibox-body">
                    <form>
                        <div class="row">
                            <div class="col-sm-6 form-group">
                                <label for="orderId">Mã đơn hàng</label>
                                <input class="form-control" type="text" id="orderId" name="orderId" value="${returnorder.orderId}" readonly placeholder="Mã đơn hàng">
                            </div>
                    <div class="col-sm-6 form-group">
                                 <label for="customerId">Ngày đặt đơn</label>
                            <input class="form-control" type="text" id="customerId" name="customerId" value="${new Date(returnorder.orderDate).toLocaleString()}" readonly placeholder="Ngày đặt">
                            </div>
                        </div>
                <div class="row">
                            <div class="col-sm-6 form-group">
                                 <label for="customerId">ID Khách hàng</label>
                                 <input class="form-control" type="text" id="customerId" name="customerId" value="${returnorder.customerId}" readonly placeholder="ID khách hàng">
                            </div>
                    <div class="col-sm-6 form-group">
                                 <label for="productId">ID sản phẩm</label>
                                 <input class="form-control" type="text" id="productId" name="productId" value="${returnorder.productId}" readonly placeholder="ID sản phẩm">
                            </div>
                        </div>
                <div class="row">
                            <div class="col-sm-6 form-group">
                                 <label for="totalPrice">Giá đơn</label>
                                 <input class="form-control" type="number" id="totalPrice" name="totalPrice" value="${returnorder.totalPrice.toFixed(2)}" readonly placeholder="Tổng giá" />
                            </div>
                    <div class="col-sm-6 form-group">
                                  <label for="orderStatus">Order Status</label>
                                  <input class="form-control" type="text" id="orderStatus" name="orderStatus" value="${returnorder.orderStatus}" readonly placeholder="Trạng thái đơn" />
                            </div>
                        </div>
                <div class="row">
                            <div class="col-sm-6 form-group">
                                <label for="DeliveryType">Delivery Type</label>
                                <input class="form-control" type="text" id="deliveryType" name="deliveryType" value="${returnorder.deliveryType}" readonly placeholder="Đơn vị giao" />
                            </div>
                    <div class="col-sm-6 form-group">
                                   <label for="DeliveryFee">Delivery Fee</label>
                            <input class="form-control" type="number" id="deliveryFee" name="deliveryFee" value="${returnorder.deliveryFee}" readonly step="0.01" placeholder="Phí giao hàng" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="paymentMethod">Payment Method</label>
                            <input class="form-control" type="text" id="paymentMethod" name="paymentMethod" value="${returnorder.paymentMethod}" readonly placeholder="Phương thức trả" />
                        </div>
                        <div class="form-group">
                            <label for="paymentStatus">Payment Status</label>
                            <input class="form-control" type="text" id="paymentStatus" name="paymentStatus" value="${returnorder.paymentStatus}" readonly placeholder="Trạng thái" />
                        </div>
                    </form>
                                    <a href="/Home/GetOrderByDealer">Về trang trước</a>
                </div>
            </div>

                                                            `;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('orderResult').textContent = 'An error occurred while sending the order.';
            }
        });
    </script>
}


