@model StationeryAPI.ShoppingModels.TblOrder
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Get Order by ID and Display";
    Layout = "~/Views/Shared/_DealerLayout.cshtml";
}

<div class="row">
    <div class="col-md-12">
        <div class="ibox">
            <div class="ibox-head">
                <div class="ibox-title">Tra cứu đơn hàng</div>
            </div>
            <div class="ibox-body">
                <form class="form-inline" id="GetOrderForm">
                    <label class="sr-only" for="orderId">Đơn hàng cần tìm</label>
                    <input class="form-control mb-2 mr-sm-2 mb-sm-0" type="text" id="orderId" placeholder="Nhập mã đơn">
                    <button class="btn btn-success" type="submit">Tìm kiếm</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Search Form -->
<!-- Placeholder for Order Details -->
<div id="orderResult"></div>

@section Scripts {
    <script>
        document.getElementById('GetOrderForm').addEventListener('submit', async function (event) {
            event.preventDefault(); // Prevent the default form submission
            var orderId = document.getElementById('orderId').value; // Get the order ID from the input

            // Fetch order details
            try {
                const response = await fetch(`https://localhost:7106/api/Customer/GetOrder/${orderId}`, {
                    method: 'GET', // Use GET method to fetch data
                    headers: {
                        'Accept': 'application/json', // Expect a JSON response
                    }
                });

                if (!response.ok) {
                    // Handle response errors
                    document.getElementById('orderResult').textContent = 'Failed to fetch order: ' + await response.text();
                } else {
                    const order = await response.json(); // Parse JSON response into JavaScript object
                    // Update the 'orderResult' div with fetched order details
                    document.getElementById('orderResult').innerHTML = `
                                                   <div class="row">
                                                    <div class="col-xl-12">
                                                        <div class="ibox">
                                                            <div class="ibox-head">
                                                                <div class="ibox-title">Kết quả tìm kiếm</div>
                                                            </div>
                                                            <div class="ibox-body">
                                                                <table class="table">
                                                                    <thead class="thead-default">
                                                                        <tr>
                                                                            <th>ID đơn hàng</th>
                                                                            <th>Mã khách hàng</th>
                                                                            <th colspan="2">Hành động</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                                    <td>${order.orderId}</td>
                                                                                    <td>${order.customerId}</td>
                                                                                    <td>
                                                                                                <button class="btn btn-danger btn-rounded" onclick="deleteOrder('${order.orderId}');">Delete</button><br/>
                                                                                    </td>
                                                                                    <td>
                                                                                                                            <a class="btn btn-info btn-rounded" href="/Home/UpdateOrder?id=${order.orderId}">Edit</a>
                                                                                     </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                             </div>
                                                    `;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('orderResult').textContent = 'An error occurred while fetching the order.';
            }
        });

        async function deleteOrder(orderId) {
            if (confirm('Are you sure you want to delete this order?')) {
                try {
                    const response = await fetch(`https://localhost:7106/api/Customer/DeleteOrder/${orderId}`, {
                        method: 'DELETE',
                        headers: {
                            'Accept': 'application/json',
                        }
                    });

                    if (!response.ok) {
                        alert('Failed to delete order: ' + await response.text());
                    } else {
                        document.getElementById('orderResult').textContent = 'Order deleted successfully';
                        // Optionally clear the input field or refresh the page
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the order.');
                }
            }
        }
    </script>
}
