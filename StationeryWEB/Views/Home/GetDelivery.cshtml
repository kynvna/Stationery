@model StationeryAPI.ShoppingModels.TblDelivery

@{
    ViewData["Title"] = "Get Delivery by ID and Display";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<div class="row">
    <div class="col-md-12">
        <div class="ibox">
            <div class="ibox-head">
                <div class="ibox-title">Tra cứu đơn giao hàng</div> - <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="UpdateDelivery">Update Delivery</a>
            </div>
            <div class="ibox-body">
                <form class="form-inline" id="GetDeliveryForm">
                    <label class="sr-only" for="deliveryId">Tìm kiếm đơn giao hàng</label>
                    <input class="form-control mb-2 mr-sm-2 mb-sm-0" type="text" id="deliveryId" placeholder="Nhập mã giao hàng">
                    <button class="btn btn-success" type="submit">Tìm kiếm</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Search Form -->
<!-- Placeholder for Order Details -->
<div id="deliveryResult"></div>

@section Scripts {
    <script>
        document.getElementById('GetDeliveryForm').addEventListener('submit', async function (event) {
            event.preventDefault(); // Prevent the default form submission
            var deliveryId = document.getElementById('deliveryId').value; // Get the order ID from the input

            // Fetch order details
            try {
                const response = await fetch(`https://localhost:7106/api/Customer/GetDelivery/${deliveryId}`, {
                    method: 'GET', // Use GET method to fetch data
                    headers: {
                        'Accept': 'application/json', // Expect a JSON response
                    }
                });

                if (!response.ok) {
                    // Handle response errors
                    document.getElementById('deliveryResult').textContent = 'Failed to fetch order: ' + await response.text();
                } else {
                    const delivery = await response.json(); // Parse JSON response into JavaScript object
                    // Update the 'orderResult' div with fetched order details
                    document.getElementById('deliveryResult').innerHTML = `
                                                              <div class="row">
                       <div class="col-xl-12">
                           <div class="ibox">
                               <div class="ibox-head">
                                   <div class="ibox-title">Kết quả tìm kiếm</div>
                               </div>
                               <div class="ibox-body">
                                   <table class="table">
                                       <thead class="thead-default">
                                           <tr>
                                               <th>ID đơn hàng</th>
                                               <th>Mã khách hàng</th>
                                               <th>Hành động</th>
                                           </tr>
                                       </thead>
                                       <tbody>
                                           <tr>
                                                               <td>${delivery.deliveryId}</td>
                                                               <td>${delivery.orderId}</td>
                                                       <td>
                                                                   <button class="btn btn-danger btn-rounded" onclick="deleteDelivery('${delivery.deliveryId}');">Delete</button>
                                                                           <button class="btn btn-info btn-rounded" onclick="">Update</button>
                                                       </td>

                                           </tr>
                                       </tbody>
                                   </table>
                               </div>
                           </div>
                       </div>
                </div>
                                            `;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('deliveryResult').textContent = 'An error occurred while fetching the order.';
            }
        });

        async function deleteDelivery(deliveryId) {
            if (confirm('Are you sure you want to delete this delivery?')) {
                try {
                    const response = await fetch(`https://localhost:7106/api/Customer/DeleteDelivery/${deliveryId}`, {
                        method: 'DELETE',
                        headers: {
                            'Accept': 'application/json',
                        }
                    });

                    if (!response.ok) {
                        alert('Failed to delete delivery: ' + await response.text());
                    } else {
                        document.getElementById('deliveryResult').textContent = 'Delivery deleted successfully';
                        // Optionally clear the input field or refresh the page
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the order.');
                }
            }
        }
    </script>
}
